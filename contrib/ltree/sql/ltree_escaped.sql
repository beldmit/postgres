-- success
SELECT E'\\.'::ltree;
SELECT E'\\ '::ltree;
SELECT E'\\\\'::ltree;
select E'\\a'::ltree;
select E'\\n'::ltree;
select E'x\\\\'::ltree;
select E'x\\ '::ltree;
select E'x\\.'::ltree;
select E'x\\a'::ltree;
select E'x\\n'::ltree;
select 'a b.с d'::ltree;

SELECT nlevel(E'Bottom\\.Test'::ltree);
SELECT subpath(E'Bottom\\.'::ltree, 0, 1);

SELECT subpath(E'a\\.b', 0, 1);
SELECT subpath(E'a\\..b', 1, 1);
SELECT subpath(E'a\\..\\b', 1, 1);
select subpath(E'a b.с d'::ltree, 1, 1);

select(
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\z\z\z\z\z')::ltree;

SELECT(
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\а\б\в\г\д')::ltree;

SELECT 'абв\|г'::lquery;
SELECT 'абв\|г'::ltree ~ 'абв\|г'::lquery;
SELECT 'абв|г'::ltree ~ 'абв*'::lquery; --true
SELECT 'абв|г'::ltree ~ 'абв\*'::lquery; --false
SELECT E'абв|\\.'::ltree ~ 'абв\|*'::lquery; --true

SELECT '""'::ltree;
SELECT E'"\\""'::ltree;
SELECT '\"'::ltree;
SELECT E'\\"'::ltree;
SELECT 'a"b'::ltree;
SELECT 'a\"b'::ltree;
SELECT '"ab"'::ltree;
SELECT E'\\"ab"'::ltree;
SELECT '"."'::ltree;
SELECT E'".\\""'::ltree;
select(
'"01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\z\z\z\z\z"')::ltree;

SELECT '""'::lquery;
SELECT E'"\\""'::lquery;
SELECT '\"'::lquery;
SELECT E'\\"'::lquery;
SELECT 'a"b'::lquery;
SELECT 'a\"b'::lquery;
SELECT '"ab"'::lquery;
SELECT E'\\"ab"'::lquery;
SELECT '"."'::lquery;
SELECT E'".\\""'::lquery;
select(
'"01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\z\z\z\z\z"')::lquery;

SELECT '"1"'::lquery;
SELECT '"2.*"'::lquery; --XXX
SELECT '!"1"'::lquery;
SELECT '!"1|"'::lquery;
SELECT '4|3|"2"'::lquery;
SELECT '"1".2'::lquery;
SELECT '"1.4"|"3"|2'::lquery; --XXX
SELECT '"1"."4"|"3"|"2"'::lquery;
SELECT '"1"."0"'::lquery;
SELECT '"1".0'::lquery;
SELECT '"1".*'::lquery;
SELECT '4|"3"|2.*'::lquery;
SELECT '4|"3"|"2.*"'::lquery; --XXX
SELECT '2."*"'::lquery;
SELECT '"*".1."*"'::lquery;
SELECT '"*.4"|3|2.*'::lquery; --
SELECT '"*.4"|3|"2.*"'::lquery; --
SELECT '1.*.4|3|2.*{,4}'::lquery;
SELECT '1.*.4|3|2.*{1,}'::lquery;
SELECT '1.*.4|3|2.*{1}'::lquery;
SELECT '"qwerty"%@*.tu'::lquery;
SELECT 'q"wert"y"%@*.tu'::lquery;

SELECT '1.*.4|3|"2".*{1,4}'::lquery; --XXX
SELECT '1."*".4|3|"2".*{1,4}'::lquery; --XXX
select '\% \@'::lquery;
select '"\% \@"'::lquery;

--failures
select E'\\'::ltree; -- error
select E'n\\'::ltree; --error
SELECT '"'::ltree;
select '"a'::ltree;
select '"a"."a'::ltree;
select '"a."a"'::ltree;

SELECT(
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'z\z\z\z\z\z')::ltree;
select(
'"01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\z\z\z\z\z\z"')::ltree;

SELECT '"'::lquery;
select '"a'::lquery;
select '"a"."a'::lquery;
select '"a."a"'::lquery;

select(
'"01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'01234567890123456789012345678901234567890123456789' ||
'\z\z\z\z\z\z"')::lquery;

